## SingleRank 文档压缩思路

**SingleRank** 是对 **TextRank** 的一种改进，旨在通过引入 **TF-IDF 权重** 来增强图的构建过程。与传统的 TextRank 主要依赖词汇的共现关系不同，SingleRank 通过结合 **TF-IDF** 权重来度量词语在文档中的重要性，进而更加精确地捕捉关键词的影响力，从而改善文档压缩的效果。

### 1. 简介

SingleRank 基于 **PageRank** 算法和 **TF-IDF** 权重，通过构建文档中各个分块之间的关键词图来提取重要信息。相较于 TextRank，SingleRank 引入了每个词的 **TF-IDF 权重**，使得算法更加注重在文档中具有更高信息量的词汇，能够更好地处理长文本和词频较低的关键词。

### 2. 带 QUERY 的 SingleRank 文档压缩

当有查询（**QUERY**）时，SingleRank 的目标是提取与查询相关性高的文档块。与传统的 TextRank 依赖共现关系不同，SingleRank 会根据 **TF-IDF** 权重来构建关键词图，使得查询关键词在图中的权重更大，从而更好地与查询相关的部分被保留下来。

#### 步骤

1. **对 QUERY 进行分词**  
   使用分词工具（如 Jieba）对查询内容进行分词，得到查询中的关键词列表。

2. **对文档进行分块**  
   将文档分为多个块（例如按段落、句子或固定字数分块），并为每个分块分配唯一的序号。

3. **对每个分块进行分词**  
   对每个文档块单独进行分词，得到块内的词汇列表。

4. **构建关键词图并计算得分（SingleRank 核心）**  
   - **节点**：每个分块中的词汇作为图中的节点。
   - **边**：基于词汇间的共现关系以及词的 **TF-IDF 权重** 来构建边。具体来说，对于任意两个词 $ w_i $ 和 $ w_j $（属于同一分块），边的权重可以根据它们的 **TF-IDF_i** 和 **TF-IDF_j** 的乘积来定义：
     $$
     \text{边权重} = \text{TF-IDF}_i \times \text{TF-IDF}_j \times \text{共现关系}
     $$
     共现关系可以用词汇间的余弦相似度或 Jaccard 相似度来表示。

5. **结合 PageRank 计算节点权重**  
   使用 **PageRank** 算法对关键词图进行迭代计算，得到每个节点（即每个词语）的权重。通过这种方式，频繁出现且在文档中有较高信息量的词汇会得到更高的权重。

6. **提取全局关键词**  
   通过计算文档整体的 PageRank 分布，选择重要性较高的关键词。那些具有较高 PageRank 值的关键词通常是文档中最具代表性和信息量最大的词汇。

7. **选择与 QUERY 相关的分块**  
   根据文档中每个分块的关键词和查询中的关键词之间的相关性，选择与查询最相关的 **TOP-N** 个分块。这可以通过计算每个分块的关键词与查询关键词的相似度（例如通过余弦相似度、Jaccard 相似度等）来完成。

8. **压缩文档并按序号排序输出**  
   根据选择的分块及其原始序号输出压缩后的文档，保留与查询相关的最重要的部分，并按逻辑顺序重新排序。

#### 优势

- **查询驱动**：SingleRank 能够结合查询关键词来引导文档压缩过程，使得压缩后的文档更贴合查询需求。
- **增强的权重计算**：通过引入 **TF-IDF 权重**，SingleRank 能够更准确地评估每个词语的重要性，从而提升文档压缩的精度。
- **全局优化**：通过 PageRank 算法，SingleRank 能够综合考虑文档中各个词的全局重要性。

### 3. 不带 QUERY 的 SingleRank 文档压缩

在没有查询（**QUERY**）的情况下，SingleRank 会自动根据文档本身的内容和关键词之间的 **TF-IDF 权重** 来提取最具信息量的文档块。

#### 步骤

1. **对文档进行分块**  
   将文档分为多个块（例如按段落、句子或固定字数分块）。

2. **对每个分块进行分词**  
   对每个文档块单独进行分词，得到块内的词汇列表。

3. **构建关键词图并计算得分**  
   - **节点**：每个分块中的词汇作为图中的节点。
   - **边**：基于词汇间的共现关系及 **TF-IDF 权重** 来构建边。对于每对词 $ w_i $ 和 $ w_j $，其边的权重由两者的 **TF-IDF 权重** 的乘积和它们的共现关系决定。
   
4. **使用 PageRank 计算节点权重**  
   使用 **PageRank** 算法对关键词图进行迭代，计算每个词汇的 PageRank 权重。那些 **TF-IDF** 权重高且与其他词汇共现频繁的词会在 PageRank 计算中获得较高的得分。

5. **提取全局关键词**  
   根据计算得到的 PageRank 分布，选择文档中最具代表性和信息量的关键词。

6. **选择 TOP-N 分块**  
   计算每个文档块的关键词与全局关键词之间的相似度，选择最具信息量的 **TOP-N** 个分块。这些分块包含了文档的核心信息。

7. **压缩文档并排序输出**  
   输出所选的 **TOP-N** 个分块，按原始顺序重新排序，生成压缩后的文档。

#### 优势

- **自动提取核心信息**：在没有查询的情况下，SingleRank 仍能根据文档本身的内容，自动提取出最具代表性的部分。
- **增强的关键词选择**：通过引入 **TF-IDF 权重**，SingleRank 更加注重词语的实际重要性，而不是单纯的共现关系。
- **全局优化**：通过 **PageRank** 算法，能够对文档中的所有关键词进行综合评估，从而更好地选取最相关的内容。

### 4. 对比

| 方案                      | 带 **QUERY** 的压缩                          | 不带 **QUERY** 的压缩                   |
|-------------------------|-----------------------------------------|---------------------------------------|
| **输入**                | 包含查询（QUERY）                        | 仅包含文档文本                        |
| **目标**                | 提取与查询相关的文档部分                    | 提取文档中的关键信息块                  |
| **关键步骤**            | 结合查询关键词，计算每个分块的关键词权重，基于 **TF-IDF** 和 PageRank 排序选择分块 | 根据 **TF-IDF** 权重和共现关系，计算每个分块的 PageRank 权重，选择最具信息量的分块 |
| **输出**                | 按照查询选择 TOP N 分块，排序输出              | 按照全局关键词选择 TOP N 分块，排序输出 |
| **优点**                 | 精准匹配查询需求，压缩文档保留查询相关部分         | 自动提取文档最有信息量的部分，无需外部输入      |

### 5. 总结

- **带 QUERY 的 SingleRank 文档压缩** 通过结合查询关键词，引导文档压缩过程，确保压缩后的文档更加贴合查询需求。
- **不带 QUERY 的 SingleRank 文档压缩** 通过计算文档内容和关键词之间的 **TF-IDF 权重**，自动提取文档中最具信息量的部分，适用于自动摘要和信息提取任务。