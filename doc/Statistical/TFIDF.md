## TF-IDF 文档压缩思路

### 1. 简介

TF-IDF（Term Frequency-Inverse Document Frequency）是一种用于评估文本中词语重要性的统计方法。在文档压缩中，TF-IDF 可以帮助提取出文档中最重要的部分。根据是否有外部查询（**QUERY**），文档压缩的思路有所不同。

### 2. 带 QUERY 的文档压缩

在有查询（**QUERY**）的情况下，文档压缩的目标是通过查询来提取出与查询最相关的文档部分。这可以帮助保留文档中与查询最相关的关键信息。

#### 步骤

1. **对 QUERY 进行分词**  
   使用分词工具（如 Jieba）对查询内容进行分词处理，得到查询的关键词。

2. **对文档进行分块**  
   将文档分为多个块（如按段落、句子或固定字数分块）。

3. **对每个分块进行分词**  
   对每个文档块单独进行分词，得到块内的词汇列表。

4. **计算 TF**  
   对每个分块，计算查询中每个分词在该分块中的出现频率（Term Frequency）。

5. **计算 IDF**  
   计算所有文档分块中，查询中每个词的 **逆文档频率**（Inverse Document Frequency），衡量该词在文档集合中的重要性。

6. **计算 TF-IDF**  
   对每个分块中的每个词，计算 **TF-IDF** 值：
   $$
   \text{TF-IDF}(t, b_i) = \text{TF}(t, b_i) \times \text{IDF}(t)
   $$

7. **选择 TOP N 分块**  
   根据 **TF-IDF** 值选择与查询最相关的 TOP N 个分块，并根据分块的原始序号进行排序。

8. **输出压缩文档**  
   输出选择的 TOP N 个分块，得到压缩后的文档。

#### 优势

- 更精确地保留与 **QUERY** 相关的内容。
- 能够过滤掉与查询无关或冗余的部分。

### 3. 不带 QUERY 的文档压缩

当没有外部查询（**QUERY**）时，文档压缩的目标是自动从文档中提取出最具代表性、信息量最大的部分。此时的选择是基于文档本身的内容。

#### 步骤

1. **对文档进行分块**  
   将文档分为多个块（同样可以按段落、句子或固定字数分块）。

2. **对每个分块进行分词**  
   对每个文档块单独进行分词，得到块内的词汇列表。

3. **计算 TF**  
   对每个分块，计算分块内每个词的 **词频（TF）**。

4. **计算 IDF**  
   计算所有文档分块中每个词的 **逆文档频率（IDF）**，衡量该词在所有文档块中的重要性。

5. **计算 TF-IDF**  
   对每个分块中的每个词，计算 **TF-IDF** 值：
   $$
   \text{TF-IDF}(t, b_i) = \text{TF}(t, b_i) \times \text{IDF}(t)
   $$

6. **选择 TOP N 分块**  
   根据每个分块中所有词的 **TF-IDF 总和**，选择 TOP N 个最重要的分块。选择时依据总和排序，分块越重要，TF-IDF 值越大。

7. **输出压缩文档**  
   输出选择的 TOP N 个分块，得到压缩后的文档。

#### 优势

- 不依赖于外部查询，可以自动从文档中提取出最重要的部分。
- 可以用于文档摘要或信息提取，尤其适合未提供明确查询时的自动化处理。

### 4. 对比

| 方案                      | 带 **QUERY** 的压缩                          | 不带 **QUERY** 的压缩                   |
|-------------------------|-----------------------------------------|---------------------------------------|
| **输入**                | 包含查询（QUERY）                        | 仅包含文档文本                        |
| **目标**                | 提取与查询相关的文档部分                    | 提取文档中的关键信息块                  |
| **关键步骤**            | 计算每个查询词的 TF 和 IDF，选择相关分块         | 计算每个词的 TF 和 IDF，选择 TF-IDF 总和最高的分块 |
| **输出**                | 按照查询选择 TOP N 分块，排序输出              | 按照 TF-IDF 评分选择 TOP N 分块，排序输出 |
| **优点**                 | 精准匹配查询需求，压缩文档保留查询相关部分         | 自动提取文档最有信息量的部分，无需外部输入      |

### 5. 总结

- **带 QUERY 的文档压缩** 通过外部查询来引导压缩过程，从而使得压缩后的文档更符合查询意图，能保留更多与查询相关的信息。
- **不带 QUERY 的文档压缩** 通过计算文档内部的词汇重要性（TF-IDF）来选择最具信息量的分块，适合自动文档摘要或内容提取任务。

两种方法的选择取决于具体的应用场景。如果有外部查询，可以使用带 QUERY 的压缩方式，以提高精度和相关性；如果没有查询，则采用不带 QUERY 的压缩方式，可以自动提取出文档的核心内容。